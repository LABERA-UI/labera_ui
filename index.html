<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Lab era</title>
	
	<link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

</head>
<body>
	<div class="container-fluid">
		<div class="row log-frm" >
			<div class="col-md-3 col-sm-12 offset-md-8" id="log-frm">
				<a href="home.php"><label for="lab era" class="display-4">LAB ERA</label></a>
				<form action="" class="form-group" name="log_frm" id="log_form" method="POST">
							<label for="username">Username</label>
							<input type="text" id="username" class="form-control" size="30" required>
							<label for="password">Password</label>
							<input type="password" id="password" class="form-control" size="30" required>
								<input type="checkbox"> Remember me
								<br>
								<div id="wrng_up" style="color: red"></div>
								<button name="log_btn" class="btn btn-success">Login</button>
								<br>
								<p class="bold">Forgot password?<a href="#" class="link"> Click Here</a></p>
					</form>

				</div>
			</div>
		</div>
		<script type="text/javascript">
			(function($){
				function processForm( e ){
					$.ajax({
						url: 'http://labera.cfapps.io/login',
						dataType: 'json',
						type: 'post',
						contentType: 'application/json',
						headers: {
							'Content-Type':'application/json'
						},
						data: JSON.stringify( {"user_name":$('#username').val(),"password":$('#password').val()} ),
						processData: false,
						success: function( data, textStatus, jQxhr ){
							var response = data  ;
							if(response["response message"]=="User exists")
							{
								if (typeof(Storage) !== "undefined") {
									localStorage.setItem('user_id',response.user.user_id);
									localStorage.setItem('user_name',response.user.user_name);
									localStorage.setItem('password',response.user.password);
									localStorage.setItem('branch',response.user.branch);
								} 
								else {
									alert("No browser support");
								}
								
								
								window.location.replace("home.html");
							}
							else if(response["response message"]=="User and/or password are incorrect")
							{
								alert("Wrong username/password.");
							}
						},
						error: function( jqXHR, exception, textStatus, errorThrown ){
							console.log( errorThrown );
							var msg = '';
							if (jqXHR.status === 0) {
								msg = 'Not connected. Verify Network.';
							} else if (jqXHR.status == 404) {
								msg = 'Requested page not found. [404]';
							} else if (jqXHR.status == 500) {
								msg = 'Internal Server Error [500].';
							} else if (exception === 'parsererror') {
								msg = 'Requested JSON parse failed.';
							} else if (exception === 'timeout') {
								msg = 'Time out error.';
							} else if (exception === 'abort') {
								msg = 'Ajax request aborted.';
							} else {
								msg = 'Uncaught Error.\n' + jqXHR.responseText;
							}
							alert(msg);

						}
					});
					e.preventDefault();
				}

				$('#log_form').submit( processForm );
			})(jQuery);
		</script>
	</body>
	<style>
	body
	{
		background-image: url("image/lab-img.jpg");
		background-repeat: no-repeat;
		background-attachment: fixed;
		background-size: cover;
		background-position: center;    
	}
	a.link:active
	{
		color:black;
		text-decoration-color: black;
	}
	a.link
	{
		color:black;
		text-decoration-color: black;
	}
	a.link
	{
		color: red;	
	}
	.bold
	{
		font-weight: bold;
	}
</style>